{"version":3,"file":"barchart-result-lazy.min.js","sources":["../src/barchart-result-lazy.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Live poll barchart result for poll rendering.\n *\n * @copyright Copyright (c) 2018 Open LMS\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\"jquery\", \"core/log\", \"mod_livepoll/result\", \"core/chartjs-lazy\"],\n    function($, Log, Result, Chart) {\n\n        /**\n         * Text result constructor.\n         * @returns {BarChartResult}\n         * @constructor\n         */\n        function BarChartResult() {\n            Result.call(this);\n            this._initialized = false;\n            this._chartType = \"bar\";\n            this._options = {\n                scales: {\n                    yAxes: [{\n                        ticks: {\n                            beginAtZero: true\n                        }\n                    }],\n                }\n            };\n            return (this);\n        }\n\n        // Prototype extension.\n        BarChartResult.prototype = Object.create(Result.prototype);\n\n        /**\n         * Initializes the Char.JS element.\n         * @param {array} options\n         */\n        BarChartResult.prototype.initChart = function(options) {\n            var ctx = document.getElementById(\"livepoll-chart\").getContext(\"2d\");\n\n            var labels = [], votes = [];\n            $.each(options, function(optionid, label) {\n                labels.push(label);\n                votes.push(0);\n            });\n\n            this._chart = new Chart(ctx, {\n                type: this._chartType,\n                data: {\n                    labels: labels,\n                    datasets: [{\n                        label: \"Votes\",\n                        data: votes,\n                        backgroundColor: [\n                            \"#ff6384\",\n                            \"#36a2eb\",\n                            \"#cc65fe\",\n                            \"#ffce56\",\n                        ],\n                    }]\n                },\n                options: this._options\n            });\n\n            Log.debug(this._chartType + \" initialized!\");\n        };\n\n        /**\n         * @param {array} options\n         * @param {array} votes\n         * @param {function} callback\n         */\n        BarChartResult.prototype.performUpdate = function(options, votes, callback) {\n            var self = this;\n            if (!self._initialized) {\n                self.initChart(options);\n                self._initialized = true;\n            }\n\n            self._chart.data.datasets[0].data = [];\n            $.each(options, function(optionid) {\n                self._chart.data.datasets[0].data.push(votes[optionid]);\n            });\n            self._chart.update();\n            callback();\n        };\n\n        return (BarChartResult);\n    }\n);"],"names":["define","$","Log","Result","Chart","BarChartResult","call","this","_initialized","_chartType","_options","scales","yAxes","ticks","beginAtZero","prototype","Object","create","initChart","options","ctx","document","getElementById","getContext","labels","votes","each","optionid","label","push","_chart","type","data","datasets","backgroundColor","debug","performUpdate","callback","self","update"],"mappings":";;;;;;AAqBAA,2CAAO,CAAC,SAAU,WAAY,sBAAuB,sBACjD,SAASC,EAAGC,IAAKC,OAAQC,gBAOZC,wBACLF,OAAOG,KAAKC,WACPC,cAAe,OACfC,WAAa,WACbC,SAAW,CACZC,OAAQ,CACJC,MAAO,CAAC,CACJC,MAAO,CACHC,aAAa,OAKrBP,YAIZF,eAAeU,UAAYC,OAAOC,OAAOd,OAAOY,WAMhDV,eAAeU,UAAUG,UAAY,SAASC,aACtCC,IAAMC,SAASC,eAAe,kBAAkBC,WAAW,MAE3DC,OAAS,GAAIC,MAAQ,GACzBxB,EAAEyB,KAAKP,SAAS,SAASQ,SAAUC,OAC/BJ,OAAOK,KAAKD,OACZH,MAAMI,KAAK,WAGVC,OAAS,IAAI1B,MAAMgB,IAAK,CACzBW,KAAMxB,KAAKE,WACXuB,KAAM,CACFR,OAAQA,OACRS,SAAU,CAAC,CACPL,MAAO,QACPI,KAAMP,MACNS,gBAAiB,CACb,UACA,UACA,UACA,cAIZf,QAASZ,KAAKG,WAGlBR,IAAIiC,MAAM5B,KAAKE,WAAa,kBAQhCJ,eAAeU,UAAUqB,cAAgB,SAASjB,QAASM,MAAOY,cAC1DC,KAAO/B,KACN+B,KAAK9B,eACN8B,KAAKpB,UAAUC,SACfmB,KAAK9B,cAAe,GAGxB8B,KAAKR,OAAOE,KAAKC,SAAS,GAAGD,KAAO,GACpC/B,EAAEyB,KAAKP,SAAS,SAASQ,UACrBW,KAAKR,OAAOE,KAAKC,SAAS,GAAGD,KAAKH,KAAKJ,MAAME,cAEjDW,KAAKR,OAAOS,SACZF,YAGIhC"}